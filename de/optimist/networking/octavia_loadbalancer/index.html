<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/de/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/de/favicon.ico" type="image/x-icon"><title>Octavia Loadbalancers | Documentation</title><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Octavia Loadbalancers" /><meta property="og:locale" content="de" /><meta name="description" content="Der Octavia Loadbalancer" /><meta property="og:description" content="Der Octavia Loadbalancer" /><link rel="canonical" href="/de/optimist/networking/octavia_loadbalancer/" /><meta property="og:url" content="/optimist/networking/octavia_loadbalancer/" /><meta property="og:site_name" content="Documentation" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-08-29T14:38:22+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Octavia Loadbalancers" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-08-29T14:38:22+00:00","datePublished":"2024-08-29T14:38:22+00:00","description":"Der Octavia Loadbalancer","headline":"Octavia Loadbalancers","mainEntityOfPage":{"@type":"WebPage","@id":"/optimist/networking/octavia_loadbalancer/"},"url":"/optimist/networking/octavia_loadbalancer/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/de/" class="site-title lh-tight"><svg class="site-logo" width="44" height="51" viewBox="0 0 44 51" fill="none" focusable="false" xmlns="http://www.w3.org/2000/svg"><path d="M21.9985 0L32.9985 6.35022L38.1104 9.30107L31.1561 13.3166L29.5221 12.3727L21.9985 8.02952L14.4749 12.3727L6.95126 16.716V25.4024V34.0888L14.4749 38.432L21.9985 42.7753L29.5221 38.432L44 30.0733V38.1043L33 44.4561L22 50.8063L11 44.4561L0 38.1043V25.4024V12.7004L11 6.34871L21.9985 0ZM21.9985 34.6597L29.1657 30.5218L36.4764 26.3009L44 21.9577V13.9267L33 20.2784L22 26.6301V34.6597H21.9985ZM28.9543 30.6441L29.1672 30.5218L28.9543 30.6441Z" fill="#111" /><path d="M21.9985 34.6588L29.1658 30.5209L36.4764 26.3L44 21.9568V13.9258L33 20.2775L22 26.6292V34.6588H21.9985ZM28.9543 30.6432L29.1673 30.5209L28.9543 30.6432Z" fill="#111" /> </svg><div class="rp_title"> Documentation</div></a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"></ul><div class="nav-category">Elastic Cloud Enterprise</div><ul class="nav-list"><li class="nav-list-item"><a href="/de/ece/intro" class="nav-list-link">Einführung</a><li class="nav-list-item"><a href="/de/ece/shipdata/" class="nav-list-link">Laden von Daten in Elastic</a><li class="nav-list-item"><a href="/de/ece/updateilm/" class="nav-list-link">Anpassen von Lifecycle Policies</a></ul><div class="nav-category">GKS</div><ul class="nav-list"></ul><div class="nav-category">Oncite Open Edition</div><ul class="nav-list"><li class="nav-list-item"><a href="/de/edge/productoverview/" class="nav-list-link">Produkt Übersicht</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Operations Center category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/de/edge/operationscenter/" class="nav-list-link">Operations Center</a><ul class="nav-list"><li class="nav-list-item "><a href="/de/edge/operationscenter/vpnaas/" class="nav-list-link">VPN as a Service</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Openstack category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/de/edge/openstack/" class="nav-list-link">Openstack</a><ul class="nav-list"><li class="nav-list-item "><a href="/de/edge/openstack/create_vm/" class="nav-list-link">VM Erstellung</a></ul><li class="nav-list-item"><a href="/de/edge/faq/" class="nav-list-link">FAQ</a></ul><div class="nav-category">Optimist</div><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Guided Tour category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/de/optimist/guided_tour/" class="nav-list-link">Guided Tour</a><ul class="nav-list"><li class="nav-list-item "><a href="/de/optimist/guided_tour/step01/" class="nav-list-link">01: Das Dashboard (Horizon)</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step02/" class="nav-list-link">02: SSH-Key per Horizon anlegen</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step03/" class="nav-list-link">03: Einen Stack starten</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step04/" class="nav-list-link">04: Der Weg vom Horizon auf die Kommandozeile</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step05/" class="nav-list-link">05: Die wichtigsten Befehle des OpenStackClients</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step06/" class="nav-list-link">06: Einen eigenen SSH-Key per Konsole erstellen und nutzen</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step07/" class="nav-list-link">07: Die erste eigene Instanz</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step08/" class="nav-list-link">08: Löschen der ersten eigenen Instanz</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step09/" class="nav-list-link">09: Die erste Security-Group</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step10/" class="nav-list-link">10: Zugriff aus dem Internet vorbereiten; Ein Netzwerk anlegen</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step11/" class="nav-list-link">11: Zugriff aus dem Internet vorbereiten; Wir ergänzen IPv6</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step12/" class="nav-list-link">12: Eine nutzbare Instanz</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step13/" class="nav-list-link">13: Der strukturierte Weg zu einer Instanz (mit Stacks)</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step14/" class="nav-list-link">14: Unsere ersten Schritte mit Heat</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step15/" class="nav-list-link">15: Das erste eigene Heat Orchestration Template (HOT)</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step16/" class="nav-list-link">16: Wir lernen Heat besser kennen</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step17/" class="nav-list-link">17: Das Netzwerk im Heat</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step18/" class="nav-list-link">18: Unsere Instanz wird von außen per IPv4 erreichbar</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step19/" class="nav-list-link">19: Unsere Instanz lernt IPv6</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step20/" class="nav-list-link">20: Mehrere Instanzen gleichzeitig erstellen</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step21/" class="nav-list-link">21: Eine Instanz von einem SSD-Volume starten</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step22/" class="nav-list-link">22: Anlegen eines DNS-Record in Designate</a><li class="nav-list-item "><a href="/de/optimist/guided_tour/step23/" class="nav-list-link">23: Der Object Storage (S3 kompatibel)</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Netzwerke category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/de/optimist/networking/" class="nav-list-link">Netzwerke</a><ul class="nav-list"><li class="nav-list-item "><a href="/de/optimist/networking/port_forwarding/" class="nav-list-link">Port Forwarding auf Floating IPs</a><li class="nav-list-item "><a href="/de/optimist/networking/shared_networks/" class="nav-list-link">Geteilte Netzwerke</a><li class="nav-list-item "><a href="/de/optimist/networking/vpnaas/" class="nav-list-link">VPN as a Service</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Storage category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/de/optimist/storage/" class="nav-list-link">Storage</a><ul class="nav-list"><li class="nav-list-item "><button class="nav-list-expander btn-reset" aria-label="toggle items in S3 Kompatiblen Objekt Storage category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/de/optimist/storage/s3_documentation/" class="nav-list-link">S3 Kompatiblen Objekt Storage</a><ul class="nav-list"><li class="nav-list-item "> <a href="/de/optimist/storage/s3_documentation/createanduses3credentials/" class="nav-list-link">S3 Kennung erstellen und einlesen</a><li class="nav-list-item "> <a href="/de/optimist/storage/s3_documentation/createanddeletebucket/" class="nav-list-link">Einen Bucket erstellen und wieder löschen</a><li class="nav-list-item "> <a href="/de/optimist/storage/s3_documentation/uploadanddeleteobject/" class="nav-list-link">Ein Objekt hochladen und löschen</a><li class="nav-list-item "> <a href="/de/optimist/storage/s3_documentation/versioning/" class="nav-list-link">Versionierung aktivieren/deaktivieren und wie eine versioniertes Objekt gelöscht wird</a><li class="nav-list-item "> <a href="/de/optimist/storage/s3_documentation/swiftservestaticwebsite/" class="nav-list-link">Swift - Serving a Static Website</a><li class="nav-list-item "> <a href="/de/optimist/storage/s3_documentation/backupwithrestic/" class="nav-list-link">Sichere Datensicherung mit Restic und Rclone</a></ul><li class="nav-list-item "><a href="/de/optimist/storage/localstorage/" class="nav-list-link">Localstorage</a></ul><li class="nav-list-item"><a href="/de/optimist/faq/" class="nav-list-link">FAQ</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Spezifikationen category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/de/optimist/specs/" class="nav-list-link">Spezifikationen</a><ul class="nav-list"><li class="nav-list-item "><a href="/de/optimist/specs/flavor_specification/" class="nav-list-link">Flavor Spezifikationen</a><li class="nav-list-item "><a href="/de/optimist/specs/default_quota/" class="nav-list-link">Default Quotas</a><li class="nav-list-item "><a href="/de/optimist/specs/application_credentials/" class="nav-list-link">Application Credentials</a><li class="nav-list-item "><a href="/de/optimist/specs/volume_specification/" class="nav-list-link">Volumenspezifikationen</a><li class="nav-list-item "><a href="/de/optimist/specs/images/" class="nav-list-link">Images</a><li class="nav-list-item "><a href="/de/optimist/specs/shelving_instances/" class="nav-list-link">Shelving-Instanzen</a></ul><li class="nav-list-item"><a href="/de/optimist/changelog/" class="nav-list-link">Changelog</a></ul></nav><a href="https://gec.io/company/zertifizierungen/" target="_blank"><div style="display: flex; justify-content: space-between; padding: 16px; width: 280px"> <img id="isoimage" src="https://s3.es1.fra.optimist.gec.io/swift/v1/static/docs/iso9001.webp" alt="ISO 9001" style="flex-grow: 1; object-fit: contain; height: 1.5rem; "> <img src="https://s3.es1.fra.optimist.gec.io/swift/v1/static/docs/iso27001.webp" alt="ISO 27001" style="flex-grow: 1; object-fit: contain; height: 1.5rem; "> <img src="https://s3.es1.fra.optimist.gec.io/swift/v1/static/docs/isae-3402-t2certified-logo-cmyk1-page-001_rdax_565x282_100.webp" alt="ISAE 3402" style="flex-grow: 1; object-fit: contain; height: 1.5rem;"></div></a> <script language="javascript" type="text/javascript"> var d = new Date(); document.getElementById("isoimage").src = "https://s3.es1.fra.optimist.gec.io/swift/v1/static/docs/iso9001.webp?ver=" + d.getTime(); </script></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Documentation" aria-label="Search Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><ul class="language-list"><li class="language-list-item"> <a class="language-list-link" href=" /optimist/networking/octavia_loadbalancer/ " >English</a ><li class="language-list-item"> <a class="language-list-link active" href=" /de/optimist/networking/octavia_loadbalancer/ " >Deutsch</a ></ul></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="">Networking</a><li class="breadcrumb-nav-list-item"><span>Octavia Loadbalancers</span></ol></nav><div id="main-content" class="main-content"><main><h1 id="der-octavia-loadbalancer"> <a href="#der-octavia-loadbalancer" class="anchor-heading" aria-labelledby="der-octavia-loadbalancer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Der Octavia Loadbalancer</h1><h2 id="vorwort"> <a href="#vorwort" class="anchor-heading" aria-labelledby="vorwort"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Vorwort</h2><p><a href="https://wiki.openstack.org/wiki/Octavia">Octavia</a> ist eine hochverfügbare und skalierbare Open-Source Load-Balancing-Lösung, die für die Arbeit mit OpenStack entwickelt wurde. Octavia erledigt das Load-Balancing nach Bedarf, indem es virtuelle Maschinen – auch Amphoren genannt – in seinem Projekt verwaltet und konfiguriert. In diesen Amphoren wirkt schlussendlich ein <a href="https://www.haproxy.com/">HAproxy</a>.</p><h2 id="der-start"> <a href="#der-start" class="anchor-heading" aria-labelledby="der-start"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Der Start</h2><p>Für die Nutzung von Octavia ist es notwendig, dass der Client auf dem eigenen System installiert ist. Eine Anleitung für sein System findet man unter <a href="/de/optimist/guided_tour/step04/">Schritt 4</a>)</p><h2 id="erstellung-eines-octavia-ladbalancer"> <a href="#erstellung-eines-octavia-ladbalancer" class="anchor-heading" aria-labelledby="erstellung-eines-octavia-ladbalancer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Erstellung eines Octavia-Ladbalancer</h2><p>Für unser Beispiel nutzen wir das aus <a href="/de/optimist/guided_tour/step10/">Schritt 10</a> schon bestehende BeispielSubnet.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer create <span class="nt">--name</span> Beispiel-LB <span class="nt">--vip-subnet-id</span> 32259126-dd37-44d5-922c-99d68ee870cd
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| admin_state_up      | True                                 |
| created_at          | 2019-05-01T09:00:00                  |
| description         |                                      |
| flavor_id           |                                      |
| <span class="nb">id</span>                  | e94827f0-f94d-40c7-a7fd-b91bf2676177 |
| listeners           |                                      |
| name                | Beispiel-LB                          |
| operating_status    | OFFLINE                              |
| pools               |                                      |
| project_id          | b15cde70d85749689e08106f973bb002     |
| provider            | amphora                              |
| provisioning_status | PENDING_CREATE                       |
| updated_at          | None                                 |
| vip_address         | 10.0.0.10                            |
| vip_network_id      | f2a8f00e-204b-4c37-9d19-1d5c8e4efbf6 |
| vip_port_id         | 37fc5b34-ee07-49c8-b054-a8d591a9679f |
| vip_qos_policy_id   | None                                 |
| vip_subnet_id       | 32259126-dd37-44d5-922c-99d68ee870cd |
+---------------------+--------------------------------------+
</code></pre></div></div><p>Nun geht Octavia her und spawned seine Amphoreninstanzen im Hintergrund.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer list
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
| <span class="nb">id</span>                                   | name        | project_id                       | vip_address  | provisioning_status | provider |
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
| e94827f0-f94d-40c7-a7fd-b91bf2676177 | Beispiel-LB | b15cde70d85749689e08106f973bb002 | 10.0.0.10    | PENDING_CREATE      | amphora  |
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
</code></pre></div></div><p>Mit dem provisioning_status <code class="language-plaintext highlighter-rouge">ACTIVE</code> ist dieser Vorgang erfolgreich abgeschlossen und der erste Octavia-Loadbalancer kann weiter konfiguiert werden.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer list
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
| <span class="nb">id</span>                                   | name        | project_id                       | vip_address  | provisioning_status | provider |
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
| e94827f0-f94d-40c7-a7fd-b91bf2676177 | Beispiel-LB | b15cde70d85749689e08106f973bb002 | 10.0.0.10    | ACTIVE              | amphora  |
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
</code></pre></div></div><h2 id="erstellen-eines-lb-listener"> <a href="#erstellen-eines-lb-listener" class="anchor-heading" aria-labelledby="erstellen-eines-lb-listener"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Erstellen eines LB-Listener</h2><p>In unserem Beispiel wollen wir einen Listener für den HTTP-Port 80 erstellen.</p><p>Als Listener ist hier - vergleichbar mit anderen LB-Lösungen - der Port des Frontends gemeint.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer listener create <span class="nt">--name</span> Beispiel-listener <span class="nt">--protocol</span> HTTP <span class="nt">--protocol-port</span> 80 Beispiel-LB
+-----------------------------+--------------------------------------+
| Field                       | Value                                |
+-----------------------------+--------------------------------------+
| admin_state_up              | True                                 |
| connection_limit            | <span class="nt">-1</span>                                   |
| created_at                  | 2019-05-01T09:00:00                  |
| default_pool_id             | None                                 |
| default_tls_container_ref   | None                                 |
| description                 |                                      |
| <span class="nb">id</span>                          | 0a3312d1-8cf7-41a8-8d24-181246468cd7 |
| insert_headers              | None                                 |
| l7policies                  |                                      |
| loadbalancers               | e94827f0-f94d-40c7-a7fd-b91bf2676177 |
| name                        | Beispiel-listener                    |
| operating_status            | OFFLINE                              |
| project_id                  | b15cde70d85749689e08106f973bb002     |
| protocol                    | HTTP                                 |
| protocol_port               | 80                                   |
| provisioning_status         | PENDING_CREATE                       |
| sni_container_refs          | <span class="o">[]</span>                                   |
| timeout_client_data         | 50000                                |
| timeout_member_connect      | 5000                                 |
| timeout_member_data         | 50000                                |
| timeout_tcp_inspect         | 0                                    |
| updated_at                  | None                                 |
| client_ca_tls_container_ref |                                      |
| client_authentication       |                                      |
| client_crl_container_ref    |                                      |
+-----------------------------+--------------------------------------+
</code></pre></div></div><p>Der Befehl war erfolgreich, wenn der <code class="language-plaintext highlighter-rouge">admin_state_up</code> <code class="language-plaintext highlighter-rouge">True</code> ist.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer listener list
+--------------------------------------+-----------------+-------------------+----------------------------------+----------+---------------+----------------+
| <span class="nb">id</span>                                   | default_pool_id | name              | project_id                       | protocol | protocol_port | admin_state_up |
+--------------------------------------+-----------------+-------------------+----------------------------------+----------+---------------+----------------+
| 0a3312d1-8cf7-41a8-8d24-181246468cd7 | None            | Beispiel-listener | b15cde70d85749689e08106f973bb002 | HTTP     |            80 | True           |
+--------------------------------------+-----------------+-------------------+----------------------------------+----------+---------------+----------------+
</code></pre></div></div><h2 id="erstellen-eines-lb-pools"> <a href="#erstellen-eines-lb-pools" class="anchor-heading" aria-labelledby="erstellen-eines-lb-pools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Erstellen eines LB-Pools</h2><p>Als LB-Pool ist hier eine Ansammlung aller Objekte (Listeners, Member, etc.) für zum Beispiel eine Region gemeint - vergleichbar mit einem Pool an öffentlichen IP-Adressen aus derer man sich eine belegen kann. Einen Pool für unser Beispiel erstellt man wie folgt:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer pool create <span class="nt">--name</span> Beispiel-pool <span class="nt">--lb-algorithm</span> ROUND_ROBIN <span class="nt">--listener</span> Beispiel-listener <span class="nt">--protocol</span> HTTP
+----------------------+--------------------------------------+
| Field                | Value                                |
+----------------------+--------------------------------------+
| admin_state_up       | True                                 |
| created_at           | 2019-05-01T09:00:00                  |
| description          |                                      |
| healthmonitor_id     |                                      |
| <span class="nb">id</span>                   | 4053e88e-c2b5-47c6-987e-4387d837c88d |
| lb_algorithm         | ROUND_ROBIN                          |
| listeners            | 0a3312d1-8cf7-41a8-8d24-181246468cd7 |
| loadbalancers        | e94827f0-f94d-40c7-a7fd-b91bf2676177 |
| members              |                                      |
| name                 | Beispiel-pool                        |
| operating_status     | OFFLINE                              |
| project_id           | b15cde70d85749689e08106f973bb002     |
| protocol             | HTTP                                 |
| provisioning_status  | PENDING_CREATE                       |
| session_persistence  | None                                 |
| updated_at           | None                                 |
| tls_container_ref    |                                      |
| ca_tls_container_ref |                                      |
| crl_container_ref    |                                      |
| tls_enabled          |                                      |
+----------------------+--------------------------------------+
</code></pre></div></div><p>Hier sei erwähnt, dass man mit <code class="language-plaintext highlighter-rouge">openstack loadbalancer pool create --help</code> sich alle möglichen Einstellungen anzeigen lassen kann. Die häufigsten Einstellungen und deren Auswahlmöglichkeiten:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--protocol</span>: <span class="o">{</span>TCP,HTTP,HTTPS,TERMINATED_HTTPS,PROXY,UDP<span class="o">}</span>
<span class="nt">--lb-algorithm</span> <span class="o">{</span>SOURCE_IP,ROUND_ROBIN,LEAST_CONNECTIONS<span class="o">}</span>
</code></pre></div></div><p>Der Pool ist erfolgreich erstellt, wenn der <code class="language-plaintext highlighter-rouge">provisioning_status</code> den Status <code class="language-plaintext highlighter-rouge">ACTIVE</code> erreicht hat.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer pool list
+--------------------------------------+---------------+----------------------------------+---------------------+----------+--------------+----------------+
| <span class="nb">id</span>                                   | name          | project_id                       | provisioning_status | protocol | lb_algorithm | admin_state_up |
+--------------------------------------+---------------+----------------------------------+---------------------+----------+--------------+----------------+
| 4053e88e-c2b5-47c6-987e-4387d837c88d | Beispiel-pool | b15cde70d85749689e08106f973bb002 | ACTIVE              | HTTP     | ROUND_ROBIN  | True           |
+--------------------------------------+---------------+----------------------------------+---------------------+----------+--------------+----------------+
</code></pre></div></div><h2 id="erstellen-der-lb-member"> <a href="#erstellen-der-lb-member" class="anchor-heading" aria-labelledby="erstellen-der-lb-member"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Erstellen der LB-<code class="language-plaintext highlighter-rouge">member</code></h2><p>Damit unser Loadbalancer weiß, an welche Backends er weiterleiten darf, fehlen uns noch sogenannte <code class="language-plaintext highlighter-rouge">member</code>, die wir wie folgt definieren:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer member create <span class="nt">--subnet-id</span> 32259126-dd37-44d5-922c-99d68ee870cd <span class="nt">--address</span>  10.0.0.11 <span class="nt">--protocol-port</span> 80 Beispiel-pool
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| address             | 10.0.0.11                            |
| admin_state_up      | True                                 |
| created_at          | 2019-05-01T09:00:00                  |
| <span class="nb">id</span>                  | 703e27e0-e7fe-474b-b32d-68f9a8aeef07 |
| name                |                                      |
| operating_status    | NO_MONITOR                           |
| project_id          | b15cde70d85749689e08106f973bb002     |
| protocol_port       | 80                                   |
| provisioning_status | PENDING_CREATE                       |
| subnet_id           | 32259126-dd37-44d5-922c-99d68ee870cd |
| updated_at          | None                                 |
| weight              | 1                                    |
| monitor_port        | None                                 |
| monitor_address     | None                                 |
| backup              | False                                |
+---------------------+--------------------------------------+
</code></pre></div></div><p>und</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer member create <span class="nt">--subnet-id</span> 32259126-dd37-44d5-922c-99d68ee870cd <span class="nt">--address</span>  10.0.0.12 <span class="nt">--protocol-port</span> 80 Beispiel-pool
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| address             | 10.0.0.12                            |
| admin_state_up      | True                                 |
| created_at          | 2019-05-01T09:00:00                  |
| <span class="nb">id</span>                  | 2add1e17-73a6-4002-82af-538a3374e5dc |
| name                |                                      |
| operating_status    | NO_MONITOR                           |
| project_id          | b15cde70d85749689e08106f973bb002     |
| protocol_port       | 80                                   |
| provisioning_status | PENDING_CREATE                       |
| subnet_id           | 32259126-dd37-44d5-922c-99d68ee870cd |
| updated_at          | None                                 |
| weight              | 1                                    |
| monitor_port        | None                                 |
| monitor_address     | None                                 |
| backup              | False                                |
+---------------------+--------------------------------------+
</code></pre></div></div><p>Hier sei erwähnt, dass die beiden IP’s aus 10.0.0.* bereits vorhandene, auf Port 80 lauschende Webserver sind, die eine einfache Webseite mit Info’s über ihren Servicenamen ausliefern. Unter der Vorraussetzung es handelt sich bei diesen Webservern im folgenden Beispiel um ein Ubuntu/Debian und man hat root-Berechtigungen, könnte man die einfache Webseite schnell erstellen mit:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@BeispielInstanz1:~# apt-get update<span class="p">;</span> apt-get <span class="nt">-y</span> <span class="nb">install </span>apache2<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"you hit: you hit: webserver1"</span> <span class="o">&gt;</span> /var/www/html/index.html


</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@BeispielInstanz2:~# apt-get update<span class="p">;</span> apt-get <span class="nt">-y</span> <span class="nb">install </span>apache2<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"you hit: you hit: webserver2"</span> <span class="o">&gt;</span> /var/www/html/index.html


</code></pre></div></div><p>Das Resultat vom Anlegen der Member können wir wie folgt überprüfen:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer member list Beispiel-pool
+--------------------------------------+------+----------------------------------+---------------------+--------------+---------------+------------------+--------+
| <span class="nb">id</span>                                   | name | project_id                       | provisioning_status | address      | protocol_port | operating_status | weight |
+--------------------------------------+------+----------------------------------+---------------------+--------------+---------------+------------------+--------+
| 703e27e0-e7fe-474b-b32d-68f9a8aeef07 |      | b15cde70d85749689e08106f973bb002 | ACTIVE              | 10.0.0.11    |            80 | NO_MONITOR       |      1 |
| 2add1e17-73a6-4002-82af-538a3374e5dc |      | b15cde70d85749689e08106f973bb002 | ACTIVE              | 10.0.0.12    |            80 | NO_MONITOR       |      1 |
+--------------------------------------+------+----------------------------------+---------------------+--------------+---------------+------------------+--------+
</code></pre></div></div><p>Nun ist das “interne” Konstrukt des Loadbalancers konfiguriert.</p><p>Wir haben nun:</p><ul><li>2 <code class="language-plaintext highlighter-rouge">member</code> die über Port 80 den tatsächlichen Service bereitstellen und zwischen denen das Loadbalancing stattfindet,<li>einen <code class="language-plaintext highlighter-rouge">pool</code> für diese <code class="language-plaintext highlighter-rouge">member</code>,<li>einen <code class="language-plaintext highlighter-rouge">listener</code>, der auf Port TCP/80 lauscht und ein <code class="language-plaintext highlighter-rouge">ROUND_ROBIN</code> zu den beiden Endpunkten macht und<li>einen Loadbalancer, über den wir alle Komponenten vereint haben.</ul><p>Der <code class="language-plaintext highlighter-rouge">operating_status</code> <code class="language-plaintext highlighter-rouge">NO_MONITOR</code> wird unter <a href="schritt24.md#erstellen-eines-healthmonitor">healthmonitor</a> korrigiert.</p><h2 id="erstellen-und-konfigurieren-der-floating-ip"> <a href="#erstellen-und-konfigurieren-der-floating-ip" class="anchor-heading" aria-labelledby="erstellen-und-konfigurieren-der-floating-ip"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Erstellen und konfigurieren der Floating-IP</h2><p>Damit wir auch den Loadbalancer außerhalb unseres Beispiel-Netzwerk einsetzen können, müssen wir eine FloatingIP reservieren und diese dann mit dem <code class="language-plaintext highlighter-rouge">vip_port_id</code> des <code class="language-plaintext highlighter-rouge">Beispiel-LB</code> verknüpfen.</p><p>Mit folgendem Befehl erstellen wir uns eine Floating IP aus dem <code class="language-plaintext highlighter-rouge">provider</code>-Netz:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack floating ip create provider
+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Field               | Value                                                                                                                                                                                                    |
+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| created_at          | 2019-05-01T09:00:00Z                                                                                                                                                                                     |
| description         |                                                                                                                                                                                                          |
| dns_domain          | None                                                                                                                                                                                                     |
| dns_name            | None                                                                                                                                                                                                     |
| fixed_ip_address    | None                                                                                                                                                                                                     |
| floating_ip_address | 185.116.247.133                                                                                                                                                                                          |
| floating_network_id | 54258498-a513-47da-9369-1a644e4be692                                                                                                                                                                     |
| <span class="nb">id</span>                  | 46c0e8cf-783d-44a0-8256-79f8ae0be7fe                                                                                                                                                                     |
| location            | Munch<span class="o">({</span><span class="s1">'project'</span>: Munch<span class="o">({</span><span class="s1">'domain_id'</span>: <span class="s1">'default'</span>, <span class="s1">'id'</span>: u<span class="s1">'b15cde70d85749689e08106f973bb002'</span>, <span class="s1">'name'</span>: <span class="s1">'beispiel-tenant'</span>, <span class="s1">'domain_name'</span>: None<span class="o">})</span>, <span class="s1">'cloud'</span>: <span class="s1">''</span>, <span class="s1">'region_name'</span>: <span class="s1">'fra'</span>, <span class="s1">'zone'</span>: None<span class="o">})</span> |
| name                | 185.116.247.133                                                                                                                                                                                          |
| port_details        | None                                                                                                                                                                                                     |
| port_id             | None                                                                                                                                                                                                     |
| project_id          | b15cde70d85749689e08106f973bb002                                                                                                                                                                         |
| qos_policy_id       | None                                                                                                                                                                                                     |
| revision_number     | 0                                                                                                                                                                                                        |
| router_id           | None                                                                                                                                                                                                     |
| status              | DOWN                                                                                                                                                                                                     |
| subnet_id           | None                                                                                                                                                                                                     |
| tags                | <span class="o">[]</span>                                                                                                                                                                                                       |
| updated_at          | 2019-05-01T09:00:00Z                                                                                                                                                                                     |
+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

</code></pre></div></div><p>Im nächsten Schritt benötigen wir die vip_port_id des Loadbalancers. Diese bekommt man mit folgendem Befehl heraus:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer show Beispiel-LB <span class="nt">-f</span> value <span class="nt">-c</span> vip_port_id
37fc5b34-ee07-49c8-b054-a8d591a9679f
</code></pre></div></div><p>Mit dem folgendem Befehl weisen wir dem Loadbalancer nun die öffentliche IP Adresse zu. Damit ist der LB (und somit auch die Endpunkte dahinter) aus dem Internet erreichbar.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack floating ip <span class="nb">set</span> <span class="nt">--port</span> 37fc5b34-ee07-49c8-b054-a8d591a9679f 185.116.247.133

</code></pre></div></div><p>Wir sind soweit, dass wir unser Loadbalancer-Deployment testen können. Mit folgendem Befehl fragen wir unseren Loadbalancer über Port TCP/80 an und bekommen anschließend eine entsprechende Antwort von den einzelnen <code class="language-plaintext highlighter-rouge">member</code> zurück:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span>1<span class="p">;</span>i&lt;<span class="o">=</span>10<span class="p">;</span>i++<span class="o">))</span><span class="p">;</span> <span class="k">do </span>curl http://185.116.247.133<span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="k">done
</span>you hit: webserver1
you hit: webserver2
you hit: webserver1
you hit: webserver2
you hit: webserver1
you hit: webserver2
you hit: webserver1
... <span class="o">(</span>usw.<span class="o">)</span>
</code></pre></div></div><h2 id="erstellen-eines-healthmonitor"> <a href="#erstellen-eines-healthmonitor" class="anchor-heading" aria-labelledby="erstellen-eines-healthmonitor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Erstellen eines healthmonitor</h2><p>Mit dem folgenden Befehl erstellen wir einen Monitor, der bei einem Ausfall eines der Backends genau dieses fehlerhafte Backend aus der Lastverteilung nimmt und somit die Webseite oder Applikation weiterhin sauber ausgeliefert wird.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer healthmonitor create <span class="nt">--delay</span> 5 <span class="nt">--max-retries</span> 2 <span class="nt">--timeout</span> 10 <span class="nt">--type</span> HTTP <span class="nt">--name</span> Beispielmonitor <span class="nt">--url-path</span> / Beispiel-pool
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| project_id          | b15cde70d85749689e08106f973bb002     |
| name                | Beispielmonitor                      |
| admin_state_up      | True                                 |
| pools               | 4053e88e-c2b5-47c6-987e-4387d837c88d |
| created_at          | 2019-05-01T09:00:00                  |
| provisioning_status | PENDING_CREATE                       |
| updated_at          | None                                 |
| delay               | 5                                    |
| expected_codes      | 200                                  |
| max_retries         | 2                                    |
| http_method         | GET                                  |
| <span class="nb">timeout</span>             | 10                                   |
| max_retries_down    | 3                                    |
| url_path            | /                                    |
| <span class="nb">type</span>                | HTTP                                 |
| <span class="nb">id</span>                  | 368f9baa-708c-4e7f-ace1-02de15598c5d |
| operating_status    | OFFLINE                              |
| http_version        |                                      |
| domain_name         |                                      |
+---------------------+--------------------------------------+
</code></pre></div></div><p>In diesem Beispiel entfernt der Monitor das fehlerhafte Backend aus dem Pool, wenn die Integritätsprüfung (–type HTTP, –url-path / ) alle zwei Fünf-Sekunden-Intervalle fehlschlägt(–delay 5, –max-retries 2, –timeout 10).</p><p>Wenn der Server wiederhergestellt wird und erneut auf TCP/80 reagiert, wird er erneut zum Pool hinzugefügt.</p><p>Ein manueller Failover kann erzwungen werden, indem der Statuscodes des Webservers ungleich “200” ist, oder gar keine Antwort des Webservers erfolgt.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer healthmonitor show Beispielmonitor
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| project_id          | b15cde70d85749689e08106f973bb002     |
| name                | Beispielmonitor                      |
| admin_state_up      | True                                 |
| pools               | 4053e88e-c2b5-47c6-987e-4387d837c88d |
| created_at          | 2019-05-01T09:00:00                  |
| provisioning_status | ACTIVE                               |
| updated_at          | 2019-05-01T09:00:00                  |
| delay               | 5                                    |
| expected_codes      | 200                                  |
| max_retries         | 2                                    |
| http_method         | GET                                  |
| <span class="nb">timeout</span>             | 10                                   |
| max_retries_down    | 3                                    |
| url_path            | /                                    |
| <span class="nb">type</span>                | HTTP                                 |
| <span class="nb">id</span>                  | 368f9baa-708c-4e7f-ace1-02de15598c5d |
| operating_status    | ONLINE                               |
| http_version        |                                      |
| domain_name         |                                      |
+---------------------+--------------------------------------+
</code></pre></div></div><p>Aus unserem Deployment-Beispiel würde das Resultat ungefähr so aussehen:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>you hit: webserver1
Mi 22 Mai 2019 17:09:39 CEST
you hit: webserver2
Mi 22 Mai 2019 17:09:40 CEST
you hit: webserver1
Mi 22 Mai 2019 17:09:41 CEST
you hit: webserver2
Mi 22 Mai 2019 17:09:42 CEST
you hit: webserver1
Mi 22 Mai 2019 17:09:43 CEST - bis hier waren beide Webserver online, doch nun ist der webserver2 offline gegangen.
you hit: webserver1
Mi 22 Mai 2019 17:09:44 CEST - noch erwarteter hit durch ROUND_ROBIN
you hit: webserver1
Mi 22 Mai 2019 17:09:50 CEST - 1. retry zu webserver2 schlägt fehl
you hit: webserver1
Mi 22 Mai 2019 17:09:56 CEST - 2. retry zu webserver2 schlägt fehl
you hit: webserver1
Mi 22 Mai 2019 17:10:01 CEST - das Backend <span class="o">(</span>webserver2<span class="o">)</span> wurde aus dem Pool genommen.
you hit: webserver1
Mi 22 Mai 2019 17:10:02 CEST
you hit: webserver1
Mi 22 Mai 2019 17:10:03 CEST
you hit: webserver1
Mi 22 Mai 2019 17:10:04 CEST
you hit: webserver1
Mi 22 Mai 2019 17:10:05 CEST
you hit: webserver1
Mi 22 Mai 2019 17:10:06 CEST
</code></pre></div></div><h2 id="monitoring-mit-prometheus"> <a href="#monitoring-mit-prometheus" class="anchor-heading" aria-labelledby="monitoring-mit-prometheus"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitoring mit Prometheus</h2><p>Der Octavia Amphora-Driver bietet einen Prometheus-Endpunkt. Auf diese Weise können Sie Metriken von Octavia-Loadbalancern sammeln.</p><p>Um einen Prometheus-Endpunkt zu einem vorhandenen Octavia-Load-Balancer hinzuzufügen, erstellen Sie einen Listener mit dem Protokoll <code class="language-plaintext highlighter-rouge">PROMETHEUS</code>. Dadurch wird der Endpunkt als <code class="language-plaintext highlighter-rouge">/metrics</code> auf dem Listener aktiviert. Der Listener unterstützt alle Funktionen eines Octavia-Load-Balancers, z. B. allowed_cidrs, unterstützt jedoch nicht das Anhängen von Pools oder L7-Richtlinien. Alle Metriken werden durch die Octavia-Objekt-ID (UUID) der Ressourcen identifiziert.</p><p>Hinweis: Derzeit werden UDP- und SCTP-Metriken nicht über Prometheus-Endpunkte gemeldet, wenn der Amphora-Provider verwendet wird.</p><p>Um beispielsweise einen Prometheus-Endpunkt auf Port 8088 für den Load Balancer <code class="language-plaintext highlighter-rouge">lb1</code> zu erstellen, führen Sie den folgenden Befehl aus:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer listener create <span class="nt">--name</span> stats-listener <span class="nt">--protocol</span> PROMETHEUS <span class="nt">--protocol-port</span> 8088 lb1
+-----------------------------+--------------------------------------+
| Field                       | Value                                |
+-----------------------------+--------------------------------------+
| admin_state_up              | True                                 |
| connection_limit            | <span class="nt">-1</span>                                   |
| created_at                  | 2021-10-03T01:44:25                  |
| default_pool_id             | None                                 |
| default_tls_container_ref   | None                                 |
| description                 |                                      |
| <span class="nb">id</span>                          | fb57d764-470a-4b6b-8820-627452f55b96 |
| insert_headers              | None                                 |
| l7policies                  |                                      |
| loadbalancers               | b081ed89-f6f8-48cb-a498-5e12705e2cf9 |
| name                        | stats-listener                       |
| operating_status            | OFFLINE                              |
| project_id                  | 4c1caeee063747f8878f007d1a323b2f     |
| protocol                    | PROMETHEUS                           |
| protocol_port               | 8088                                 |
| provisioning_status         | PENDING_CREATE                       |
| sni_container_refs          | <span class="o">[]</span>                                   |
| timeout_client_data         | 50000                                |
| timeout_member_connect      | 5000                                 |
| timeout_member_data         | 50000                                |
| timeout_tcp_inspect         | 0                                    |
| updated_at                  | None                                 |
| client_ca_tls_container_ref | None                                 |
| client_authentication       | NONE                                 |
| client_crl_container_ref    | None                                 |
| allowed_cidrs               | None                                 |
| tls_ciphers                 | None                                 |
| tls_versions                | None                                 |
| alpn_protocols              | None                                 |
| tags                        |                                      |
+-----------------------------+--------------------------------------+
</code></pre></div></div><p>Sobald der PROMETHEUS-Listener AKTIV ist, können Sie Prometheus so konfigurieren, dass es Metriken vom Load Balancer sammelt, indem Sie die Datei prometheus.yml aktualisieren.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">[</span><span class="nv">scrape_configs</span><span class="pi">]</span>
<span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Octavia</span><span class="nv"> </span><span class="s">LB1'</span>
  <span class="na">static_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">192.0.2.10:8088'</span><span class="pi">]</span>
</code></pre></div></div><h2 id="bekannte-probleme"> <a href="#bekannte-probleme" class="anchor-heading" aria-labelledby="bekannte-probleme"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bekannte Probleme</h2><p>Wenn sie bei der Zuweisung der öffentliche IP Adresse zum Loadbalancer folgenden Fehler bekommen:</p><p><code class="language-plaintext highlighter-rouge"> ResourceNotFound: 404: Client Error for url: https://network.fra.optimist.gec.io/v2.0/floatingips/46c0e8cf-783d-44a0-8256-79f8ae0be7fe, External network 54258498-a513-47da-9369-1a644e4be692 is not reachable from subnet 32259126-dd37-44d5-922c-99d68ee870cd. Therefore, cannot associate Port 37fc5b34-ee07-49c8-b054-a8d591a9679f with a Floating IP. </code></p><p>dann fehlt eine Verbindung zwischen ihrem Beispiel-Netz (Router) und dem Provider-Netz (<a href="/de/optimist/guided_tour/step10/">Schritt 10</a>)</p><p>Die default-connect-Einstellung der haproxy-Prozesse innerhalb einer Amphore liegen bei 50 Sekunden, d.h. wenn eine Verbindung länger als 50 Sekunden anhalten soll, müssen sie am Listener diese Werte entsprechend konfigurieren. Beispiel für einen Connect mit Timeout:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">time </span>kubectl <span class="nt">-n</span> kube-system <span class="nb">exec</span> <span class="nt">-ti</span> machine-controller-5f649c5ff4-pksps /bin/sh
~ <span class="err">$</span>
50.69 real         0.08 user         0.05 sys
</code></pre></div></div><p>Um in diesem Beispiel den Timeout auf 4h zu erweitern:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack loadbalancer listener <span class="nb">set</span> <span class="nt">--timeout_client_data</span> 14400000 &lt;Listener ID&gt;
openstack loadbalancer listener <span class="nb">set</span> <span class="nt">--timeout_member_data</span> 14400000 &lt;Listener ID&gt;
</code></pre></div></div><p>Wenn Octavia versucht, einen LB mit <code class="language-plaintext highlighter-rouge">port_security_enabled = False</code> in einem Netzwerk zu starten, wird der LB in den Status ERROR versetzt.</p><h2 id="abschluss"> <a href="#abschluss" class="anchor-heading" aria-labelledby="abschluss"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Abschluss</h2><p>Es macht durchaus Sinn immer einen Monitor für seinen Pool zu etablieren. <img src="attachments/201905S240012.png" alt="" /></p></main><hr><footer> <br/><br/><br/><div class="footer-navigation-links"> <a class="footer-navigation-link footer-navigation-link--previous" href="/de/optimist/networking/shared_networks/"> <svg class="footer-navigation-link__icon" viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> <span class="footer-navigation-link__sublabel">Zurück</span> <span class="footer-navigation-link__label">Geteilte Netzwerke</span> </a> <a class="footer-navigation-link footer-navigation-link--next" href="/de/optimist/networking/vpnaas/"> <svg class="footer-navigation-link__icon" viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> <span class="footer-navigation-link__sublabel">Weiter</span> <span class="footer-navigation-link__label">VPN as a Service</span> </a></div><div class="footer-links"><div class=footer-hosted-with-love> <a href="https://github.com/gecio/gecio.github.io" target="_blank" rel="noopener noreferrer" >Mit liebe gehostet bei GitHub</a></div><div class="footer-external-links"><ul><li class="footer-external-link"> <a href="https://gec.io" target="_blank" rel="noopener noreferrer" >Website</a ><li class="footer-external-link"> <a href="https://gec.io/impressum/" target="_blank" rel="noopener noreferrer" >Impressum</a ><li class="footer-external-link"> <a href="https://gec.io/datenschutz/" target="_blank" rel="noopener noreferrer" >Datenschutz</a ></ul></div></div></footer></div></div><div class="search-overlay"></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
